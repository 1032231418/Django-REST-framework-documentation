<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://www.django-rest-framework.org/api-guide/content-negotiation/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Content negotiation - Django REST framework中文站点</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Django REST framework中文站点</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorial <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../tutorial/quickstart/">Quickstart</a>
</li>
                            
<li >
    <a href="../../tutorial/1-serialization/">1 - Serialization</a>
</li>
                            
<li >
    <a href="../../tutorial/2-requests-and-responses/">2 - Requests and responses</a>
</li>
                            
<li >
    <a href="../../tutorial/3-class-based-views/">3 - Class based views</a>
</li>
                            
<li >
    <a href="../../tutorial/4-authentication-and-permissions/">4 - Authentication and permissions</a>
</li>
                            
<li >
    <a href="../../tutorial/5-relationships-and-hyperlinked-apis/">5 - Relationships and hyperlinked APIs</a>
</li>
                            
<li >
    <a href="../../tutorial/6-viewsets-and-routers/">6 - Viewsets and routers</a>
</li>
                            
<li >
    <a href="../../tutorial/7-schemas-and-client-libraries/">7 - Schemas and client libraries</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../requests_zh/">Requests</a>
</li>
                            
<li >
    <a href="../responses_zh/">Responses</a>
</li>
                            
<li >
    <a href="../views/">Views</a>
</li>
                            
<li >
    <a href="../generic-views_zh/">Generic views</a>
</li>
                            
<li >
    <a href="../viewsets_zh/">Viewsets</a>
</li>
                            
<li >
    <a href="../routers_zh/">Routers</a>
</li>
                            
<li >
    <a href="../parsers_zh/">Parsers</a>
</li>
                            
<li >
    <a href="../renderers_zh/">Renderers</a>
</li>
                            
<li >
    <a href="../serializers_zh/">Serializers</a>
</li>
                            
<li >
    <a href="../fields/">Serializer fields</a>
</li>
                            
<li >
    <a href="../relations/">Serializer relations</a>
</li>
                            
<li >
    <a href="../validators/">Validators</a>
</li>
                            
<li >
    <a href="../authentication_zh/">Authentication</a>
</li>
                            
<li >
    <a href="../permissions/">Permissions</a>
</li>
                            
<li >
    <a href="../throttling/">Throttling</a>
</li>
                            
<li >
    <a href="../filtering_zh/">Filtering</a>
</li>
                            
<li >
    <a href="../pagination/">Pagination</a>
</li>
                            
<li >
    <a href="../versioning/">Versioning</a>
</li>
                            
<li class="active">
    <a href="./">Content negotiation</a>
</li>
                            
<li >
    <a href="../metadata/">Metadata</a>
</li>
                            
<li >
    <a href="../schemas/">Schemas</a>
</li>
                            
<li >
    <a href="../format-suffixes/">Format suffixes</a>
</li>
                            
<li >
    <a href="../reverse/">Returning URLs</a>
</li>
                            
<li >
    <a href="../exceptions/">Exceptions</a>
</li>
                            
<li >
    <a href="../status-codes/">Status codes</a>
</li>
                            
<li >
    <a href="../testing/">Testing</a>
</li>
                            
<li >
    <a href="../settings/">Settings</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Topics <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../topics/documenting-your-api/">Documenting your API</a>
</li>
                            
<li >
    <a href="../../topics/api-clients/">API Clients</a>
</li>
                            
<li >
    <a href="../../topics/internationalization/">Internationalization</a>
</li>
                            
<li >
    <a href="../../topics/ajax-csrf-cors/">AJAX, CSRF & CORS</a>
</li>
                            
<li >
    <a href="../../topics/html-and-forms/">HTML & Forms</a>
</li>
                            
<li >
    <a href="../../topics/browser-enhancements/">Browser Enhancements</a>
</li>
                            
<li >
    <a href="../../topics/browsable-api/">The Browsable API</a>
</li>
                            
<li >
    <a href="../../topics/rest-hypermedia-hateoas/">REST, Hypermedia & HATEOAS</a>
</li>
                            
<li >
    <a href="../../topics/third-party-packages/">Third Party Packages</a>
</li>
                            
<li >
    <a href="../../topics/tutorials-and-resources/">Tutorials and Resources</a>
</li>
                            
<li >
    <a href="../../topics/contributing/">Contributing to REST framework</a>
</li>
                            
<li >
    <a href="../../topics/project-management/">Project management</a>
</li>
                            
<li >
    <a href="../../topics/3.0-announcement/">3.0 Announcement</a>
</li>
                            
<li >
    <a href="../../topics/3.1-announcement/">3.1 Announcement</a>
</li>
                            
<li >
    <a href="../../topics/3.2-announcement/">3.2 Announcement</a>
</li>
                            
<li >
    <a href="../../topics/3.3-announcement/">3.3 Announcement</a>
</li>
                            
<li >
    <a href="../../topics/3.4-announcement/">3.4 Announcement</a>
</li>
                            
<li >
    <a href="../../topics/3.5-announcement/">3.5 Announcement</a>
</li>
                            
<li >
    <a href="../../topics/kickstarter-announcement/">Kickstarter Announcement</a>
</li>
                            
<li >
    <a href="../../topics/mozilla-grant/">Mozilla Grant</a>
</li>
                            
<li >
    <a href="../../topics/funding/">Funding</a>
</li>
                            
<li >
    <a href="../../topics/release-notes/">Release Notes</a>
</li>
                            
<li >
    <a href="../../topics/jobs/">Jobs</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../versioning/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../metadata/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/tomchristie/django-rest-framework">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#content-negotiation">Content negotiation</a></li>
            <li><a href="#determining-the-accepted-renderer">Determining the accepted renderer</a></li>
        <li class="main "><a href="#custom-content-negotiation">Custom content negotiation</a></li>
            <li><a href="#example">Example</a></li>
            <li><a href="#setting-the-content-negotiation">Setting the content negotiation</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">
<div class="source-links">

    <span class="label label-primary">negotiation.py</span>

</div>


<h1 id="content-negotiation"><a class="toclink" href="#content-negotiation">Content negotiation</a></h1>
<blockquote>
<p>HTTP has provisions for several mechanisms for "content negotiation" - the process of selecting the best representation for a given response when there are multiple representations available.</p>
<p>&mdash; <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec12.html">RFC 2616</a>, Fielding et al.</p>
</blockquote>
<p>Content negotiation is the process of selecting one of multiple possible representations to return to a client, based on client or server preferences.</p>
<h2 id="determining-the-accepted-renderer"><a class="toclink" href="#determining-the-accepted-renderer">Determining the accepted renderer</a></h2>
<p>REST framework uses a simple style of content negotiation to determine which media type should be returned to a client, based on the available renderers, the priorities of each of those renderers, and the client's <code>Accept:</code> header.  The style used is partly client-driven, and partly server-driven.</p>
<ol>
<li>More specific media types are given preference to less specific media types.</li>
<li>If multiple media types have the same specificity, then preference is given to based on the ordering of the renderers configured for the given view.</li>
</ol>
<p>For example, given the following <code>Accept</code> header:</p>
<pre><code>application/json; indent=4, application/json, application/yaml, text/html, */*
</code></pre>
<p>The priorities for each of the given media types would be:</p>
<ul>
<li><code>application/json; indent=4</code></li>
<li><code>application/json</code>, <code>application/yaml</code> and <code>text/html</code></li>
<li><code>*/*</code></li>
</ul>
<p>If the requested view was only configured with renderers for <code>YAML</code> and <code>HTML</code>, then REST framework would select whichever renderer was listed first in the <code>renderer_classes</code> list or <code>DEFAULT_RENDERER_CLASSES</code> setting.</p>
<p>For more information on the <code>HTTP Accept</code> header, see <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">RFC 2616</a></p>
<hr />
<p><strong>Note</strong>: "q" values are not taken into account by REST framework when determining preference.  The use of "q" values negatively impacts caching, and in the author's opinion they are an unnecessary and overcomplicated approach to content negotiation.</p>
<p>This is a valid approach as the HTTP spec deliberately underspecifies how a server should weight server-based preferences against client-based preferences.</p>
<hr />
<h1 id="custom-content-negotiation"><a class="toclink" href="#custom-content-negotiation">Custom content negotiation</a></h1>
<p>It's unlikely that you'll want to provide a custom content negotiation scheme for REST framework, but you can do so if needed.  To implement a custom content negotiation scheme override <code>BaseContentNegotiation</code>.</p>
<p>REST framework's content negotiation classes handle selection of both the appropriate parser for the request, and the appropriate renderer for the response, so you should implement both the <code>.select_parser(request, parsers)</code> and <code>.select_renderer(request, renderers, format_suffix)</code> methods.</p>
<p>The <code>select_parser()</code> method should return one of the parser instances from the list of available parsers, or <code>None</code> if none of the parsers can handle the incoming request.</p>
<p>The <code>select_renderer()</code> method should return a two-tuple of (renderer instance, media type), or raise a <code>NotAcceptable</code> exception.</p>
<h2 id="example"><a class="toclink" href="#example">Example</a></h2>
<p>The following is a custom content negotiation class which ignores the client
request when selecting the appropriate parser or renderer.</p>
<pre><code>from rest_framework.negotiation import BaseContentNegotiation

class IgnoreClientContentNegotiation(BaseContentNegotiation):
    def select_parser(self, request, parsers):
        """
        Select the first parser in the `.parser_classes` list.
        """
        return parsers[0]

    def select_renderer(self, request, renderers, format_suffix):
        """
        Select the first renderer in the `.renderer_classes` list.
        """
        return (renderers[0], renderers[0].media_type)
</code></pre>
<h2 id="setting-the-content-negotiation"><a class="toclink" href="#setting-the-content-negotiation">Setting the content negotiation</a></h2>
<p>The default content negotiation class may be set globally, using the <code>DEFAULT_CONTENT_NEGOTIATION_CLASS</code> setting.  For example, the following settings would use our example <code>IgnoreClientContentNegotiation</code> class.</p>
<pre><code>REST_FRAMEWORK = {
    'DEFAULT_CONTENT_NEGOTIATION_CLASS': 'myapp.negotiation.IgnoreClientContentNegotiation',
}
</code></pre>
<p>You can also set the content negotiation used for an individual view, or viewset, using the <code>APIView</code> class-based views.</p>
<pre><code>from myapp.negotiation import IgnoreClientContentNegotiation
from rest_framework.response import Response
from rest_framework.views import APIView

class NoNegotiationView(APIView):
    """
    An example view that does not perform content negotiation.
    """
    content_negotiation_class = IgnoreClientContentNegotiation

    def get(self, request, format=None):
        return Response({
            'accepted media type': request.accepted_renderer.media_type
        })
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
